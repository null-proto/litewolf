<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Sign in - YouTube Bot</title>
	<link rel="stylesheet" href="{{ url_for('static', path='login.css') }}">
</head>

<body>
	<!-- Alert (hidden by default) -->
	<div class="alert alert-info" id="alert">
		<strong>Info:</strong> OAuth authentication is required for full access.
	</div>

	{% include "components/signin.j2" %}

	<script>

		// Handle form submission
		function handleLogin(event) {
			event.preventDefault();

			const email = document.getElementById('email').value;
			const password = document.getElementById('password').value;

			// Show loading
			const submitBtn = event.target.querySelector('button[type="submit"]');
			const originalText = submitBtn.innerHTML;
			submitBtn.innerHTML = 'Signing in...';
			submitBtn.disabled = true;

			// Simulate API call
			fetch('/auth/signin', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({email, password})
			})
				.then(response => response.json())
				.then(data => {
					if (data.success) {
						showAlert('success', 'Login successful! Redirecting...');
						setTimeout(() => {
							window.location.href = '/dashboard';
						}, 1000);
					} else {
						showAlert('error', data.message || 'Login failed. Please try again.');
						submitBtn.innerHTML = originalText;
						submitBtn.disabled = false;
					}
				})
				.catch(error => {
					showAlert('error', 'An error occurred. Please try again.');
					submitBtn.innerHTML = originalText;
					submitBtn.disabled = false;
				});
		}

		// Show alert message
		function showAlert(type, message) {
			const alert = document.getElementById('alert');
			alert.className = `alert alert-${type}`;

			const title = type === 'error' ? 'Error' : type === 'success' ? 'Success' : 'Info';

			alert.innerHTML = `<strong>${title}:</strong> ${message}`;
			alert.style.display = 'block';

			// Auto-hide after 5 seconds
			setTimeout(() => {
				alert.style.display = 'none';
			}, 5000);
		}

		// Check for URL parameters (e.g., ?error=invalid_credentials)
		window.addEventListener('DOMContentLoaded', () => {
			const urlParams = new URLSearchParams(window.location.search);
			const error = urlParams.get('error');
			const message = urlParams.get('message');

			if (error) {
				const errorMessages = {
					'invalid_credentials': 'Invalid email or password.',
					'account_locked': 'Your account has been locked. Contact support.',
					'email_not_verified': 'Please verify your email address.',
					'session_expired': 'Your session has expired. Please sign in again.'
				};
				showAlert('error', errorMessages[error] || 'An error occurred.');
			}

			if (message) {
				showAlert('info', decodeURIComponent(message));
			}
		});


		// passwd
		function togglePasswordVisibility() {
			const passwordInput = document.getElementById('password');
			const type = passwordInput.type === 'password' ? 'text' : 'password';
			passwordInput.type = type;
		}
	</script>
</body>

</html>
